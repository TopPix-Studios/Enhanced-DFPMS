{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Event Statistics</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .progress-bar {
            background-color: #007bff;
        }
        .progress-container {
            margin-top: 15px;
        }
        .chart-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .chart-card {
            width: 100%;
            max-height: 100%;
            padding: 10px;
            box-sizing: border-box;
            margin-bottom: 10px;
            margin: 0 auto;
        }
        .custom-card {
            flex: 1 1 18%; /* Allow cards to shrink or grow, and set their base width */
            max-width: 18%; /* Ensure cards fit evenly in a row */
            margin: 0 0.5%; /* Add horizontal spacing */
        }
        
        @media (max-width: 991px) {
            .custom-card {
                flex: 1 1 30%; /* Adjust card size for medium screens */
                max-width: 30%;
            }
        }
        
        @media (max-width: 767px) {
            .custom-card {
                flex: 1 1 45%; /* Adjust card size for small screens */
                max-width: 45%;
            }
        }
        
        @media (max-width: 575px) {
            .custom-card {
                flex: 1 1 100%; /* Full width for extra small screens */
                max-width: 100%;
            }
        }
        
    </style>
</head>
<body>
    
    <div class="container-fluid mt-4">
    
        <div class="row g-4">
            <!-- Chart Grid for Event Statistics -->
            <div class="col-lg-12 col-md-12">
                <div class="row g-3">
                    <div class="form-row align-items-end mb-2">
                        <div class="form-group col-lg-4 col-md-6 mb-2">
                            <label for="tagFilter">Filter by Tag:</label>
                            <select id="tagFilter" class="form-control">
                                <option value="">All Tags</option>
                            </select>
                        </div>
                    
                        <div class="form-group col-lg-4 col-md-6 mb-2">
                            <label for="eventFilter">Filter by Event Name:</label>
                            <select id="eventFilter" class="form-control">
                                <option value="">All Events</option>
                            </select>
                        </div>
                        
                    
                        <div class="form-group col-lg-4 col-md-12 mb-2">
                            <button id="filterButton" class="btn btn-primary btn-block">Apply Filters</button>
                        </div>
                    </div>
                    
                    
                    <div class="card row w-100 p-3 d-flex flex-lg-row flex-column h-100">
                        <div class="chart-card p-3 col-lg-8 col-md-12 card shadow-sm p-3 pb-0" style="height: 500px;"> <!-- ðŸ”¥ Add fixed height -->
                            <h6 class="text-center mb-3">Attendance Per Event</h6> <!-- ðŸ”¥ Change to Per Event -->
                            <canvas id="attendanceChart" width="900" height="400"></canvas> <!-- ðŸ”¥ Set fixed width and height -->
                        </div>
                        
                        <div class="col-lg-4 col-md-12 d-flex flex-column">
                            <div class="card shadow-sm p-0 mb-3">
                                <div class="card-body text-center">
                                    <strong style="font-size: 1rem;">Overall Number of Unique Attendees</strong>
                                    <p class="text-primary" id="total-attendees" style="font-size: 2rem; margin: 0;">0</p>
                                    <p class="text-secondary" style="font-size: 1rem; margin: 0;">
                                        Averaging <span id="average-attendance-per-event">0</span> attendees per Event
                                    </p>
                                    <small class="text-muted" style="font-size: 0.8rem;">
                                        This is the total count of people who attended the event.
                                    </small>
                                </div>
                            </div>
                        
                            <div class="card shadow-sm p-0 mb-3">
                                <div class="card-body text-center">
                                    <strong style="font-size: 1rem;">Number of PWD Unique Attendees</strong>
                                    <p class="text-primary" id="pwd-count" style="font-size: 1.8rem; margin: 0;">0</p>
                                    <small class="text-muted" style="font-size: 0.8rem;">
                                        Percentage of attendees with disabilities:
                                        <span id="pwd-percentage">0%</span>
                                    </small>
                                </div>
                            </div>
                        
                            <div class="card shadow-sm p-0">
                                <div class="card-body text-center">
                                    <strong style="font-size: 1rem;">Number of 4Ps Unique Attendees</strong>
                                    <p class="text-primary" id="four-ps-count" style="font-size: 1.8rem; margin: 0;">0</p>
                                    <small class="text-muted" style="font-size: 0.8rem;">
                                        Percentage of attendees part of 4Ps:
                                        <span id="four-ps-percentage">0%</span>
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="card shadow-sm p-2 mt-3 w-100">
                            <h6 class="text-center mb-4">PWD and 4Ps Breakdown by Age Group (Filtered Events)</h6>
                            <div class="chart-card">
                                <canvas id="filteredStackedChart" style="width: 100%; height: 500px;"></canvas>
                            </div>
                
                            <!-- Summary Cards below the stacked chart -->
                            <div class="container mt-4">
                                <div class="row">
                              
                                  <!-- Gender Distribution -->
                                  <div class="col-lg-3 col-md-6 mb-4">
                                    <div class="card shadow-sm h-100">
                                      <div class="card-body">
                                        <h6 class="card-title font-weight-bold text-center mb-3">Gender Distribution (Filtered)</h6>
                                        <table class="table table-sm table-borderless mb-0">
                                          <tbody>
                                            <tr><td>Male</td><td class="text-primary text-right"><span id="filtered-male-count">0</span></td></tr>
                                            <tr><td>Female</td><td class="text-primary text-right"><span id="filtered-female-count">0</span></td></tr>
                                            <tr><td>Other</td><td class="text-primary text-right"><span id="filtered-other-count">0</span></td></tr>
                                          </tbody>
                                        </table>
                                      </div>
                                    </div>
                                  </div>
                              
                                  <!-- Age Distribution -->
                                  <div class="col-lg-3 col-md-6 mb-4">
                                    <div class="card shadow-sm h-100">
                                      <div class="card-body">
                                        <h6 class="card-title font-weight-bold text-center mb-3">Age Distribution (Filtered)</h6>
                                        <table class="table table-sm table-borderless mb-0">
                                          <tbody>
                                            <tr><td>20â†“</td><td class="text-primary text-right"><span id="filtered-age-a-count">0</span></td></tr>
                                            <tr><td>20â€“29</td><td class="text-primary text-right"><span id="filtered-age-b-count">0</span></td></tr>
                                            <tr><td>30â€“39</td><td class="text-primary text-right"><span id="filtered-age-c-count">0</span></td></tr>
                                            <tr><td>40â€“49</td><td class="text-primary text-right"><span id="filtered-age-d-count">0</span></td></tr>
                                            <tr><td>50+</td><td class="text-primary text-right"><span id="filtered-age-e-count">0</span></td></tr>
                                          </tbody>
                                        </table>
                                      </div>
                                    </div>
                                  </div>
                              
                                  <!-- PWDs Distribution -->
                                  <div class="col-lg-3 col-md-6 mb-4">
                                    <div class="card shadow-sm h-100">
                                      <div class="card-body">
                                        <div class="d-flex flex-column align-items-start">
                                            <h6 class="card-title font-weight-bold text-center w-100 mb-2">PWDs Distribution</h6>
                                            <small class="text-muted font-weight-bold">By Gender:</small>
                                          </div>
                                                                             
                                        <table class="table table-sm table-borderless">
                                          <tbody>
                                            <tr><td>Male</td><td class="text-primary text-right"><span id="filtered-pwd-m-count">0</span></td></tr>
                                            <tr><td>Female</td><td class="text-primary text-right"><span id="filtered-pwd-f-count">0</span></td></tr>
                                            <tr><td>Other</td><td class="text-primary text-right"><span id="filtered-pwd-o-count">0</span></td></tr>
                                          </tbody>
                                        </table>
                              
                                        <small class="text-muted font-weight-bold">By Age:</small>
                                        <table class="table table-sm table-borderless mb-0">
                                          <tbody>
                                            <tr><td>20â†“</td><td class="text-primary text-right"><span id="filtered-pwd-a-count">0</span></td></tr>
                                            <tr><td>20â€“29</td><td class="text-primary text-right"><span id="filtered-pwd-b-count">0</span></td></tr>
                                            <tr><td>30â€“39</td><td class="text-primary text-right"><span id="filtered-pwd-c-count">0</span></td></tr>
                                            <tr><td>40â€“49</td><td class="text-primary text-right"><span id="filtered-pwd-d-count">0</span></td></tr>
                                            <tr><td>50+</td><td class="text-primary text-right"><span id="filtered-pwd-e-count">0</span></td></tr>
                                          </tbody>
                                        </table>
                                      </div>
                                    </div>
                                  </div>
                              
                                  <!-- 4Ps Distribution -->
                                  <div class="col-lg-3 col-md-6 mb-4">
                                    <div class="card shadow-sm h-100">
                                      <div class="card-body">
                                        <div class="d-flex flex-column align-items-start">
                                            <h6 class="card-title font-weight-bold text-center w-100 mb-2">4Ps Distribution</h6>
                                            <small class="text-muted font-weight-bold">By Gender:</small>
                                          </div>
                                          
                                        <table class="table table-sm table-borderless">
                                          <tbody>
                                            <tr><td>Male</td><td class="text-primary text-right"><span id="filtered-fourps-m-count">0</span></td></tr>
                                            <tr><td>Female</td><td class="text-primary text-right"><span id="filtered-fourps-f-count">0</span></td></tr>
                                            <tr><td>Other</td><td class="text-primary text-right"><span id="filtered-fourps-o-count">0</span></td></tr>
                                          </tbody>
                                        </table>
                              
                                        <small class="text-muted font-weight-bold">By Age:</small>
                                        <table class="table table-sm table-borderless mb-0">
                                          <tbody>
                                            <tr><td>20â†“</td><td class="text-primary text-right"><span id="filtered-fourps-a-count">0</span></td></tr>
                                            <tr><td>20â€“29</td><td class="text-primary text-right"><span id="filtered-fourps-b-count">0</span></td></tr>
                                            <tr><td>30â€“39</td><td class="text-primary text-right"><span id="filtered-fourps-c-count">0</span></td></tr>
                                            <tr><td>40â€“49</td><td class="text-primary text-right"><span id="filtered-fourps-d-count">0</span></td></tr>
                                            <tr><td>50+</td><td class="text-primary text-right"><span id="filtered-fourps-e-count">0</span></td></tr>
                                          </tbody>
                                        </table>
                                      </div>
                                    </div>
                                  </div>
                              
                                </div> <!-- /row -->
                              </div> <!-- /container -->

                        </div>   
                    </div>

                    <div class="card row w-100 p-3 d-flex flex-lg-row flex-column">
                        <div class="d-flex flex-lg-row flex-column w-100">
                            <!-- Left Side Cards -->
                            <div class="col-lg-3 col-md-12 d-flex flex-column">
                                 <div class="card mb-3 shadow-sm">
                                    <div class="card-body text-center">
                                        <strong style="font-size: 1rem;">Converted Attendance</strong>
                                        <p class="text-primary" id="converted-attendance-count" style="font-size: 1.8rem; margin: 0;">0</p>
                                        <small class="text-muted" style="font-size: 1rem;">Percentage: <span id="converted-attendance-percentage">0</span>%</small>
                                    </div>
                                </div>
                                <div class="card mb-3 shadow-sm">
                                    <div class="card-body text-center">
                                        <strong style="font-size: 1rem;">Total RSVPs</strong>
                                        <p class="text-primary" id="total-rsvps" style="font-size: 1.8rem; margin: 0;">0</p>
                                        <div class="card-body p-0 text-left">
                                            <div class="mb-2">
                                                <strong>Interested:</strong>
                                                <span class="text-primary" id="interested-count">0</span>
                                                <small class="text-muted">(Percentage: <span id="interested-percentage">0</span>%)</small>
                                            </div>
                                            <div class="mb-2">
                                                <strong>Not Attending:</strong>
                                                <span class="text-primary" id="not-attending-count">0</span>
                                                <small class="text-muted">(Percentage: <span id="not-attending-percentage">0</span>%)</small>
                                            </div>
                                            <div class="mb-2">
                                                <strong>Attending:</strong>
                                                <span class="text-primary" id="attending-count">0</span>
                                                <small class="text-muted">(Percentage: <span id="attending-percentage">0</span>%)</small>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Collapsible Supporting Details -->
                                       
                                </div>
                                 <!-- Average RSVPs per Event -->
                                <div class="card mb-3 shadow-sm">
                                    <div class="card-body text-center">
                                        <strong style="font-size: 1rem;">Average RSVPs per Event</strong>
                                        <p class="text-primary"style="font-size: 1.8rem; margin: 0;"><span id="average-rsvps-per-event" >0</span> RSVPs</p>
                                        <small class="text-muted" style="font-size: 1rem;">The average number of RSVPs per event.</small><br>

                                    </div>
                                </div>
                            </div>
                            {% comment %} <div class="col-lg-3 col-md-12 d-flex flex-column">
                                
                            </div> {% endcomment %}
                            <!-- Chart Center -->
                            <div class="card col-lg-9 col-md-12 p-0">
                                <div class="chart-card px-0 pb-0 pt-0">
                                    <h6 class="text-center mb-3">RSVP and Attendance Comparisson</h6>
                                    <canvas id="rsvpAttendanceChart"></canvas>
                                </div>
                            </div>
                    
                            <!-- Right Side Cards -->
                          
                        </div>
                    </div>
                    
                    
                    <div class="card row w-100 p-3 d-flex flex-lg-row flex-column">
                        <div class="d-flex flex-lg-row flex-column w-100">
                        
                    
                            <!-- Chart Center -->
                            <div class="card col-lg-9 col-md-12 p-3 shadow-sm pb-5">
                                <div class="chart-card p-3 pb-3">
                                    <h6 class="text-center mb-3">Gender Ratio</h6>
                                    <canvas id="genderRatioChart"></canvas>
                                </div>
                            </div>
                    
                            <!-- Right Side Cards -->
                            <div class="col-lg-3 col-md-12 d-flex flex-column">
                                <div class="card mb-3 shadow-sm">
                                    <div class="card-body text-center">
                                        <strong>Other</strong>
                                        <p class="display-5 text-primary" id="other-count" style="font-size: 1.8rem; margin: 0;">0</p>
                                        <small class="text-muted">Overall number of other attendees.</small>
                                    </div>
                                </div>
                                <div class="card mb-3 shadow-sm">
                                    <div class="card-body text-center">
                                        <strong>Male</strong>
                                        <p class="display-5 text-primary" id="male-count" style="font-size: 1.8rem; margin: 0;">0</p>
                                        <small class="text-muted">Overall number of male attendees.</small>
                                    </div>
                                </div>
                                <div class="card mb-3 shadow-sm">
                                    <div class="card-body text-center">
                                        <strong>Female</strong>
                                        <p class="display-5 text-primary" id="female-count" style="font-size: 1.8rem; margin: 0;">0</p>
                                        <small class="text-muted">Overall number of female attendees.</small>
                                    </div>
                                </div>
                                <div class="card mb-3 shadow-sm">
                                    <div class="card-body text-center">
                                        <strong style="font-size: 1rem; margin: 0;">Overall</strong>
                                        <p class="display-5 text-primary" id="total-gender-count" style="font-size: 1.8rem; margin: 0;">0</p>
                                        <small class="text-muted">Overall total of attendees by gender.</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    

                    <div class="card row w-100 p-3 d-flex flex-lg-row flex-column">
                        <!-- Chart Center -->
                        <div class="card shadow-sm col-12 p-3 mb-4">
                            <div class="chart-card p-3">
                                <h6 class="text-center mb-3">Age Range Distribution</h6>
                                <canvas id="ageRangeChart"></canvas>
                            </div>
                            <br>
                               <!-- Cards Below the Chart -->
                            <div class="d-flex flex-wrap justify-content-center w-100 mt-3">
                                <!-- Individual Cards -->
                                <div class="custom-card col-lg-2 col-md-4 col-sm-6 mb-3">
                                    <div class="card shadow-sm" style="width: 120%">
                                        <div class="card-body text-center">
                                            <strong>20 Below</strong>
                                            <p class="display-6 text-primary" id="age-20-below-count" style="font-size: 1.8rem; margin: 0;">0</p>
                                            <small class="text-muted">Individuals aged 20 and below.</small>
                                        </div>
                                    </div>
                                </div>
                            
                                <div class="custom-card col-lg-2 col-md-4 col-sm-6 mb-3">
                                    <div class="card shadow-sm" style="width: 120%">
                                        <div class="card-body text-center">
                                            <strong>20-29</strong>
                                            <p class="display-6 text-primary" id="age-20-29-count" style="font-size: 1.8rem; margin: 0;">0</p>
                                            <small class="text-muted">Individuals aged 20-29.</small>
                                        </div>
                                    </div>
                                </div>
                            
                                <div class="custom-card col-lg-2 col-md-4 col-sm-6 mb-3">
                                    <div class="card shadow-sm" style="width: 120%">
                                        <div class="card-body text-center">
                                            <strong>30-39</strong>
                                            <p class="display-6 text-primary" id="age-30-39-count" style="font-size: 1.8rem; margin: 0;">0</p>
                                            <small class="text-muted">Individuals aged 30-39.</small>
                                        </div>
                                    </div>
                                </div>
                            
                                <div class="custom-card col-lg-2 col-md-4 col-sm-6 mb-3">
                                    <div class="card shadow-sm" style="width: 120%">
                                        <div class="card-body text-center">
                                            <strong>40-49</strong>
                                            <p class="display-6 text-primary" id="age-40-49-count" style="font-size: 1.8rem; margin: 0;">0</p>
                                            <small class="text-muted">Individuals aged 40-49.</small>
                                        </div>
                                    </div>
                                </div>
                            
                                <div class="custom-card col-lg-2 col-md-4 col-sm-6 mb-3">
                                    <div class="card shadow-sm" style="width: 120%">
                                        <div class="card-body text-center">
                                            <strong>50+</strong>
                                            <p class="display-6 text-primary" id="age-50-plus-count" style="font-size: 1.8rem; margin: 0;">0</p>
                                            <small class="text-muted">Individuals aged 50 and above.</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    
                     
                    </div>
                    
                </div>
            </div>
    
            <!-- Insights Section -->
          
            
        </div>
     
    </div>
    

    <script>
        const eventStatisticsUrl = "{% url 'overall_event_statistics' %}";
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="{% static 'js/event_statistics.js' %}"></script>
    <script src="{% static 'js/event_statistics_filters.js' %}"></script>

</body>
</html>
