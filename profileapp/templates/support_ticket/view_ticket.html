{% extends 'home.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static "ticket.css" %}">
<style>
    .ticket-container {
        max-width: 98vw;
        padding: 1rem;
    }
    
    .conversation {
        margin-bottom: 1.5rem;
        background-color: white;
        padding: 1rem;
        border-radius: 10px;
        height: 400px;
        overflow-y: scroll;
    }

    .message-container {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .message {
        max-width: 75%;
        padding: 0.75rem 1rem;
        border-radius: 10px;
        position: relative;
        display: inline-block;
    }
    
    .user-message {
        background-color: #dcf8c6;
        align-self: flex-end;
        border-bottom-right-radius: 0;
    }
    
    .admin-message {
        background-color: #ffffff;
        align-self: flex-start;
        border-bottom-left-radius: 0;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .message p {
        margin: 0;
    }

    .message small {
        display: block;
        text-align: right;
        font-size: 12px;
        color: #888;
    }

    .message .read-status {
        font-size: 10px;
        color: #888;
        text-align: right;
    }

    .input-container {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-top: 1rem;
    }

    .message-input {
        flex: 1;
        padding: 0.75rem;
        font-size: 1rem;
        border-radius: 25px;
        border: 1px solid #ccc;
        outline: none;
    }

    .back-button {
        background-color: var(--secondary-color);
        color: #ebecff;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        transition: background-color 0.3s;
        font-family: 'Garet', sans-serif;
        font-size: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
        border-radius: 5px;
        margin-bottom: 1rem;
    }
    
    .back-button:hover {
        background-color: var(--background-color);
        color: var(--secondary-color);
        border: 1px solid var(--secondary-color);
    }
</style>

<div class="ticket-container">
    <div class="header-container">
        <button class="back-button" onclick="window.history.back();">
            <i class="fas fa-arrow-left"></i> Back
        </button>
        
        <h1>Ticket: {{ ticket.subject }}</h1>
    </div>
    
    <div class="conversation">
        <div class="message-container">
            {% for message in messages %}
            <div class="message {% if message.sender == request.user %}user-message{% else %}admin-message{% endif %}">
                <p><strong>{{ message.sender.username }}:</strong></p>
                <p>{{ message.message }}</p>
                <small>{{ message.created_at|date:"F d, Y H:i" }}</small>
                <div class="read-status">
                    {% if message.sender != request.user %}
                        {% if message.is_read %}
                            <em>Read</em>
                        {% else %}
                            <em>Unread</em>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
            {% empty %}
            <p>No messages yet.</p>
            {% endfor %}
        </div>
    </div>

    <div class="input-container">
        <form method="post" style="flex: 1; display: flex; gap: 0.5rem; width: 55vw;">
            {% csrf_token %}
            <input type="text" name="message" class="message-input" placeholder="Type your message..." required>
            <button type="submit" class="btn-submit">Send</button>
        </form>
    </div>
</div>
{% endblock %}
